===============================================================================
VLM-VLA Agent æ¨¡å‹æ¨ç†åº”ç”¨æ€»ç»“
===============================================================================

ğŸ¯ è®­ç»ƒå®Œæˆåå¦‚ä½•åº”ç”¨æ¨¡å‹ï¼Ÿ

è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹ä¼šä¿å­˜ä¸ºæ£€æŸ¥ç‚¹æ–‡ä»¶ã€‚ä½ å¯ä»¥ç”¨è¿™äº›æ–‡ä»¶è¿›è¡Œæ¨ç†é¢„æµ‹ã€‚

===============================================================================
ğŸ“¦ ä¸‰ç§æ¨ç†æ–¹å¼ï¼ˆæ¨èç¨‹åº¦ï¼‰
===============================================================================

æ–¹å¼ 1ï¼ˆâ­â­â­ æœ€ç®€å•ï¼‰ï¼šå¿«é€Ÿæ¨ç†è„šæœ¬
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

å‘½ä»¤è¡Œä¸€è¡Œä»£ç ï¼š

    python quick_inference.py \
        --use-best \
        --image1 before.jpg \
        --image2 after.jpg \
        --caption "building change"

å¯è§†åŒ–ç»“æœï¼š

    python quick_inference.py \
        --use-best \
        --visualize \
        --output result.jpg \
        --image1 before.jpg \
        --image2 after.jpg \
        --caption "change"


æ–¹å¼ 2ï¼ˆâ­â­â­ æ¨èï¼‰ï¼šPython ä»£ç é›†æˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

from src.inference import VLMInference

# åˆå§‹åŒ–
inference = VLMInference("checkpoint_best.pt")

# å•ä¸ªæ¨ç†
result = inference.predict("before.jpg", "after.jpg", "change description")
print(f"ä¸­å¿ƒ: ({result['cx']:.4f}, {result['cy']:.4f})")
print(f"å°ºåº¦: {result['scale']:.4f}")

# æ‰¹å¤„ç†æ¨ç†
results = inference.batch_predict(image_pairs, captions)


æ–¹å¼ 3ï¼ˆâ­â­ é«˜çº§ï¼‰ï¼šè‡ªå®šä¹‰é›†æˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

å¯è§†åŒ–ç»“æœã€ä¿®æ”¹è®¾å¤‡ã€è‡ªå®šä¹‰æ¨¡å‹è·¯å¾„ç­‰ã€‚
è¯¦è§ INFERENCE_GUIDE.md


===============================================================================
ğŸ“Š æ¨¡å‹è¾“å‡ºè¯´æ˜
===============================================================================

æ¨¡å‹é¢„æµ‹åŠ¨ä½œå‘é‡ [cx, cy, scale]ï¼Œéƒ½æ˜¯ 0-1 ä¹‹é—´çš„æµ®ç‚¹æ•°ï¼š

    cx    = å˜åŒ–ä¸­å¿ƒçš„ X åæ ‡ (0=å·¦è¾¹, 1=å³è¾¹)
    cy    = å˜åŒ–ä¸­å¿ƒçš„ Y åæ ‡ (0=ä¸Šè¾¹, 1=ä¸‹è¾¹)
    scale = å˜åŒ–çš„å¤§å°/å°ºåº¦  (0=å¾®å°, 1=å¤§è§„æ¨¡)

è½¬æ¢ä¸ºåƒç´ åæ ‡ï¼ˆå›¾åƒå¤§å° H Ã— Wï¼‰ï¼š

    center_x = int(cx * W)
    center_y = int(cy * H)
    radius = int(scale * max(H, W) / 2)


===============================================================================
âœ… æ£€æŸ¥ç‚¹æ–‡ä»¶
===============================================================================

è®­ç»ƒåçš„è¾“å‡ºç›®å½•ç»“æ„ï¼š

    output/
    â””â”€â”€ checkpoint_20260116_075102/
        â”œâ”€â”€ checkpoint_best.pt          â­ ä½¿ç”¨è¿™ä¸ªï¼ˆæœ€ä¼˜æ¨¡å‹ï¼‰
        â”œâ”€â”€ checkpoint_latest.pt
        â”œâ”€â”€ checkpoint_step_X.pt
        â””â”€â”€ metrics.json


æ¨èå§‹ç»ˆä½¿ç”¨ checkpoint_best.ptï¼Œå®ƒåœ¨éªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½ã€‚


===============================================================================
âš¡ æ€§èƒ½å‚è€ƒ
===============================================================================

GPUï¼ˆNVIDIA T4ï¼‰ï¼š
    å•æ ·æœ¬ï¼š100-200ms
    æ‰¹å¤§å° 4ï¼š30-50ms/æ ·æœ¬
    å†…å­˜ï¼š~3GB

CPUï¼š
    å•æ ·æœ¬ï¼š1-2s
    æ‰¹å¤§å° 4ï¼š300-500ms/æ ·æœ¬
    å†…å­˜ï¼š~2GB


===============================================================================
ğŸ“– æ›´å¤šæ–‡æ¡£
===============================================================================

è¯¦ç»†æŒ‡å—ï¼š
    - å¦‚ä½•åº”ç”¨æ¨¡å‹.md        (æ¨èé¦–å…ˆé˜…è¯»)
    - INFERENCE_GUIDE.md    (è¯¦ç»†æŠ€æœ¯æ–‡æ¡£)

å¿«é€Ÿè„šæœ¬å¸®åŠ©ï¼š
    python quick_inference.py --help


===============================================================================
ğŸš€ å¿«é€Ÿä½¿ç”¨ç¤ºä¾‹
===============================================================================

# ç¤ºä¾‹ 1ï¼šåŸºç¡€æ¨ç†
python quick_inference.py \
    --use-best \
    --image1 dataset/img1_before.jpg \
    --image2 dataset/img1_after.jpg \
    --caption "building construction area"


# ç¤ºä¾‹ 2ï¼šå¯è§†åŒ–ç»“æœ
python quick_inference.py \
    --use-best \
    --visualize \
    --image1 dataset/img2_before.jpg \
    --image2 dataset/img2_after.jpg \
    --caption "road expansion" \
    --output result.jpg


# ç¤ºä¾‹ 3ï¼šPython é›†æˆ
from src.inference import VLMInference
from pathlib import Path

# è‡ªåŠ¨æ‰¾æœ€ä¼˜æ£€æŸ¥ç‚¹
checkpoints = list(Path("output").glob("checkpoint_*/checkpoint_best.pt"))
checkpoint = sorted(checkpoints, key=lambda x: x.stat().st_mtime)[-1]

# æ¨ç†
inference = VLMInference(str(checkpoint))
result = inference.predict("img1.jpg", "img2.jpg", "changes")

print(f"é¢„æµ‹ç»“æœï¼šcx={result['cx']:.3f}, cy={result['cy']:.3f}, scale={result['scale']:.3f}")


===============================================================================
â“ å¸¸è§é—®é¢˜
===============================================================================

Q1ï¼šå¦‚ä½•è‡ªåŠ¨æ‰¾åˆ°æœ€å¥½çš„æ¨¡å‹ï¼Ÿ
Aï¼šä½¿ç”¨ --use-best å‚æ•°è‡ªåŠ¨æŸ¥æ‰¾æœ€ä¼˜æ£€æŸ¥ç‚¹

Q2ï¼šå¯ä»¥åœ¨ CPU ä¸Šè¿è¡Œå—ï¼Ÿ
Aï¼šå¯ä»¥ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢ï¼ˆ1-2s/æ ·æœ¬ï¼‰ï¼Œä½¿ç”¨ --device cpu

Q3ï¼šå¦‚ä½•å¤„ç†å¤šå¼ å›¾åƒï¼Ÿ
Aï¼šä½¿ç”¨ batch_predict() æ–¹æ³•ï¼Œé€Ÿåº¦å¿« 2-3 å€

Q4ï¼šå¦‚ä½•åœ¨ Kaggle ä¸Šä½¿ç”¨ï¼Ÿ
Aï¼šå°† checkpoint_best.pt ä¸Šä¼ ï¼Œä½¿ç”¨ç›¸åŒçš„æ¨ç†ä»£ç 

Q5ï¼šç»“æœä¸å¯¹æ€ä¹ˆåŠï¼Ÿ
Aï¼šæ£€æŸ¥å›¾åƒè´¨é‡ã€æ–‡æœ¬æè¿°æ˜¯å¦å‡†ç¡®


===============================================================================
ğŸ“Œ æ€»ç»“ï¼š3 æ­¥å®Œæˆæ¨ç†
===============================================================================

1ï¸âƒ£  é€‰æ‹©æ£€æŸ¥ç‚¹
    ä½¿ç”¨ output/checkpoint_XXX/checkpoint_best.pt

2ï¸âƒ£  åˆå§‹åŒ–æ¨ç†å™¨
    inference = VLMInference("checkpoint_best.pt")

3ï¸âƒ£  æ‰§è¡Œæ¨ç†
    result = inference.predict("img1.jpg", "img2.jpg", "caption")


å°±è¿™ä¹ˆç®€å•ï¼ğŸ‰


===============================================================================
ä¸‹ä¸€æ­¥
===============================================================================

âœ“ å·²å®Œæˆï¼šæ¨¡å‹è®­ç»ƒå’Œæ¨ç†æ¡†æ¶
âœ“ å·²å®Œæˆï¼šå¿«é€Ÿæ¨ç†è„šæœ¬å’Œæ–‡æ¡£
âœ“ å·²å®Œæˆï¼šç£ç›˜ä¼˜åŒ–ï¼Œæ”¯æŒ Kaggle

å¯é€‰æ”¹è¿›ï¼š
â–¡ æ¨¡å‹é‡åŒ–ï¼ˆINT8ï¼‰ä»¥æé«˜é€Ÿåº¦
â–¡ ONNX å¯¼å‡ºç”¨äºè·¨å¹³å°éƒ¨ç½²
â–¡ æ¨¡å‹å¾®è°ƒä»¥é€‚åº”ç‰¹å®šé¢†åŸŸæ•°æ®
â–¡ åˆ›å»º Web API æœåŠ¡

===============================================================================


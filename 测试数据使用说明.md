# ğŸ“‹ æµ‹è¯•æ•°æ®ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`validation_on_kaggle.py` è„šæœ¬å·²æ›´æ–°ï¼Œç°åœ¨**ä¼˜å…ˆä½¿ç”¨ test æ–‡ä»¶å¤¹ä¸­çš„æ•°æ®**è¿›è¡ŒéªŒè¯/æµ‹è¯•ã€‚

---

## æ•°æ®é›†ç»“æ„

```
levir-cc-dataset/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ test/          â† â­ ç°åœ¨ä¼˜å…ˆä½¿ç”¨æ­¤æ–‡ä»¶å¤¹
â”‚   â”‚   â”œâ”€â”€ A/         # æ—¶é—´ç‚¹1çš„æµ‹è¯•å½±åƒ
â”‚   â”‚   â””â”€â”€ B/         # æ—¶é—´ç‚¹2çš„æµ‹è¯•å½±åƒ
â”‚   â”œâ”€â”€ train/         # è®­ç»ƒé›†
â”‚   â”œâ”€â”€ val/           # éªŒè¯é›†
â”‚   â””â”€â”€ ...
â””â”€â”€ LevirCCcaptions.json
```

---

## æ•°æ®åŠ è½½ä¼˜å…ˆçº§

è„šæœ¬ç°åœ¨æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§åŠ è½½æ•°æ®ï¼š

```
1ï¸âƒ£  test     (æµ‹è¯•é›†) â† âœ… æœ€ä¼˜å…ˆ
2ï¸âƒ£  validation (éªŒè¯é›†)
3ï¸âƒ£  val      (éªŒè¯é›†çš„å¦ä¸€ä¸ªåç§°)
4ï¸âƒ£  å…¶ä»–å¯ç”¨åˆ†å‰²
```

---

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨ï¼ˆä½¿ç”¨ test æ•°æ®ï¼‰

```bash
python validation_on_kaggle.py \
    --checkpoint output/checkpoint_best.pt
```

**è¾“å‡ºç¤ºä¾‹**:
```
âœ… æ‰¾åˆ° 'test' åˆ†å‰²ï¼ŒåŒ…å« 500 ä¸ªæ ·æœ¬
âœ… æ•°æ®åŠ è½½å™¨åˆ›å»ºå®Œæˆï¼Œå…± 125 ä¸ªæ‰¹æ¬¡
```

### å¸¦å¯è§†åŒ–çš„æµ‹è¯•

```bash
python validation_on_kaggle.py \
    --checkpoint output/checkpoint_best.pt \
    --visualize \
    --save-samples 15
```

### è‡ªå®šä¹‰å‚æ•°

```bash
python validation_on_kaggle.py \
    --checkpoint output/checkpoint_best.pt \
    --batch-size 16 \
    --num-workers 8 \
    --visualize \
    --save-samples 20
```

---

## è¾“å‡ºä¿¡æ¯

è¿è¡Œè„šæœ¬æ—¶ï¼Œä¼šåœ¨åŠ è½½æ•°æ®æ—¶æ˜¾ç¤ºä½¿ç”¨çš„æ•°æ®é›†ï¼š

```
============================================================
åŠ è½½éªŒè¯æ•°æ®
============================================================
ğŸ” å°è¯•ä» /kaggle/input/levir-cc-dataset/LEVIR-CC åŠ è½½æ•°æ®...
âœ… æˆåŠŸä» /kaggle/input/levir-cc-dataset/LEVIR-CC åŠ è½½æ•°æ®
âœ… æ‰¾åˆ° 'test' åˆ†å‰²ï¼ŒåŒ…å« 500 ä¸ªæ ·æœ¬  â† è¿™é‡Œæ˜¾ç¤ºä½¿ç”¨äº† test æ•°æ®
```

---

## ç”Ÿæˆçš„æ–‡ä»¶

è¿è¡Œå®Œæˆåï¼Œä¼šåœ¨è¾“å‡ºç›®å½•ç”Ÿæˆï¼š

```
output/
â”œâ”€â”€ validation_report.json
â”‚   â””â”€ åŒ…å«:
â”‚      - avg_loss
â”‚      - mae, rmse
â”‚      - r2_score
â”‚      - per_dim_mae, per_dim_rmse
â”‚      - num_samples (500)
â”‚      - num_batches
â”‚
â””â”€â”€ visualizations/
    â”œâ”€â”€ predictions_analysis.png
    â”‚   â””â”€ 4ä¸ªå­å›¾: é¢„æµ‹vsçœŸå®ã€è¯¯å·®åˆ†å¸ƒã€æ®‹å·®å›¾ã€è¶‹åŠ¿
    â”‚
    â””â”€â”€ sample_predictions.png
        â””â”€ æ ·æœ¬é¢„è§ˆ: è¾“å…¥å›¾åƒ + é¢„æµ‹ç»“æœ
```

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæ”¹æˆç”¨ test æ•°æ®ï¼Ÿ

**A:** test æ–‡ä»¶å¤¹åŒ…å«ç‹¬ç«‹çš„æµ‹è¯•é›†ï¼Œç”¨äºæœ€ç»ˆæ¨¡å‹è¯„ä¼°ã€‚è¿™æ ·å¯ä»¥ï¼š
- è¯„ä¼°æ¨¡å‹åœ¨å®Œå…¨é™Œç”Ÿæ•°æ®ä¸Šçš„è¡¨ç°
- é¿å…æ•°æ®æ³„éœ²
- å¾—åˆ°æ›´çœŸå®çš„æ€§èƒ½æŒ‡æ ‡

### Q: å¦‚ä½•åˆ‡å›ä½¿ç”¨ val æ•°æ®ï¼Ÿ

**A:** ç›®å‰æ— éœ€ä¿®æ”¹ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨è¯†åˆ«å¯ç”¨çš„æ•°æ®é›†ã€‚å¦‚æœéœ€è¦å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šåˆ†å‰²ï¼Œå¯ä»¥ä¿®æ”¹æºä»£ç ä¸­çš„ä¼˜å…ˆçº§é€»è¾‘ã€‚

### Q: å¦‚æœæ•°æ®é›†ä¸­æ²¡æœ‰ test åˆ†å‰²æ€ä¹ˆåŠï¼Ÿ

**A:** è„šæœ¬ä¼šè‡ªåŠ¨é€€å›åˆ°ä¸‹ä¸€ä¸ªä¼˜å…ˆçº§ï¼š
1. å¦‚æœæœ‰ `validation`ï¼Œä½¿ç”¨ `validation`
2. å¦åˆ™å¦‚æœæœ‰ `val`ï¼Œä½¿ç”¨ `val`
3. å¦åˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªå¯ç”¨çš„åˆ†å‰²

### Q: test åˆ†å‰²æœ‰å¤šå°‘ä¸ªæ ·æœ¬ï¼Ÿ

**A:** æ ¹æ®æ‚¨çš„æ•°æ®é›†è€Œå®šã€‚è¿è¡Œè„šæœ¬æ—¶ä¼šåœ¨è¾“å‡ºä¸­æ˜¾ç¤ºï¼Œä¾‹å¦‚ï¼š
```
âœ… æ‰¾åˆ° 'test' åˆ†å‰²ï¼ŒåŒ…å« 500 ä¸ªæ ·æœ¬
```

---

## è¯¦ç»†å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--checkpoint` | str | **å¿…éœ€** | æ£€æŸ¥ç‚¹æ–‡ä»¶è·¯å¾„ |
| `--batch-size` | int | 4 | æ¯æ‰¹å¤„ç†æ ·æœ¬æ•° |
| `--num-workers` | int | 4 | æ•°æ®åŠ è½½å·¥ä½œè¿›ç¨‹æ•° |
| `--device` | str | auto | è®¡ç®—è®¾å¤‡ï¼ˆauto/cuda/cpuï¼‰ |
| `--output-dir` | str | output | è¾“å‡ºç›®å½• |
| `--visualize` | flag | - | ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ |
| `--save-samples` | int | 10 | å¯è§†åŒ–æ ·æœ¬æ•° |

---

## å¿«é€Ÿå‚è€ƒ

```bash
# âš¡ æœ€å¿«éªŒè¯ï¼ˆæ— å¯è§†åŒ–ï¼‰
python validation_on_kaggle.py --checkpoint output/checkpoint_best.pt

# ğŸ¨ æ¨èç”¨æ³•ï¼ˆå¸¦å¯è§†åŒ–ï¼‰
python validation_on_kaggle.py \
    --checkpoint output/checkpoint_best.pt \
    --visualize --save-samples 15

# ğŸ“Š è¯¦ç»†åˆ†æï¼ˆä¿å­˜æ›´å¤šæ ·æœ¬ï¼‰
python validation_on_kaggle.py \
    --checkpoint output/checkpoint_best.pt \
    --visualize --save-samples 50

# âš™ï¸ é«˜æ€§èƒ½éªŒè¯ï¼ˆå¤§æ‰¹æ¬¡ï¼‰
python validation_on_kaggle.py \
    --checkpoint output/checkpoint_best.pt \
    --batch-size 16 --num-workers 8

# ğŸ’» CPU éªŒè¯
python validation_on_kaggle.py \
    --checkpoint output/checkpoint_best.pt \
    --device cpu
```

---

## å·¥ä½œæµç¨‹

```
1. è¿è¡ŒéªŒè¯è„šæœ¬
   â†“
2. è‡ªåŠ¨åŠ è½½ test åˆ†å‰²æ•°æ®
   â†“
3. åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹æ£€æŸ¥ç‚¹
   â†“
4. åœ¨æ•´ä¸ª test æ•°æ®é›†ä¸Šè¿›è¡Œå‰å‘ä¼ æ’­
   â†“
5. è®¡ç®—æ€§èƒ½æŒ‡æ ‡ (loss, MAE, RMSE, RÂ²ç­‰)
   â†“
6. ä¿å­˜ JSON æŠ¥å‘Š
   â†“
7. (å¯é€‰) ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
   â†“
8. å®Œæˆï¼æŸ¥çœ‹ output/validation_report.json
```

---

## é¢„æœŸè¾“å‡ºç¤ºä¾‹

```
============================================================
ğŸš€ Kaggle éªŒè¯è„šæœ¬ v2.0
============================================================
ğŸ“± ä½¿ç”¨è®¾å¤‡: cuda
ğŸ“‚ æ£€æŸ¥ç‚¹: output/checkpoint_best.pt
ğŸ“Š æ‰¹æ¬¡å¤§å°: 4
ğŸ¨ å¯è§†åŒ–: å¯ç”¨ (æ ·æœ¬æ•°: 15)
============================================================

ğŸ”„ å‡†å¤‡éªŒè¯æ•°æ®...
============================================================
åŠ è½½éªŒè¯æ•°æ®
============================================================
ğŸ” å°è¯•ä» /kaggle/input/levir-cc-dataset/LEVIR-CC åŠ è½½æ•°æ®...
âœ… æˆåŠŸä» /kaggle/input/levir-cc-dataset/LEVIR-CC åŠ è½½æ•°æ®
âœ… æ‰¾åˆ° 'test' åˆ†å‰²ï¼ŒåŒ…å« 500 ä¸ªæ ·æœ¬

åˆ›å»ºæ•°æ®åŠ è½½å™¨ (batch_size=4, num_workers=4)
âœ… æ•°æ®åŠ è½½å™¨åˆ›å»ºå®Œæˆï¼Œå…± 125 ä¸ªæ‰¹æ¬¡

ğŸ”„ åŠ è½½æ¨¡å‹...
âœ… æ¨¡å‹å·²åŠ è½½: output/checkpoint_best.pt

============================================================
å¼€å§‹éªŒè¯
============================================================
éªŒè¯è¿›åº¦: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 125/125 [02:15<00:00,  0.92it/s]

============================================================
éªŒè¯ç»“æœ
============================================================
å¹³å‡æŸå¤±: 0.1234
åŠ¨ä½œæŸå¤±: 0.1234
å¹³å‡ç»å¯¹è¯¯å·® (MAE): 0.0845
å‡æ–¹æ ¹è¯¯å·® (RMSE): 0.1123
RÂ² åˆ†æ•°: 0.8765
éªŒè¯æ ·æœ¬æ•°: 500
éªŒè¯æ‰¹æ¬¡æ•°: 125

============================================================
éªŒè¯å®Œæˆ!
============================================================
ğŸ“„ æŠ¥å‘Šä½ç½®: output/validation_report.json
ğŸ¨ å¯è§†åŒ–æ–‡ä»¶ä½ç½®: output/visualizations
```

---

## æŠ€æœ¯ç»†èŠ‚

### æ•°æ®åŠ è½½æµç¨‹

```python
# ä¼˜å…ˆçº§æ£€æŸ¥
if "test" in dataset:
    use test
elif "validation" in dataset:
    use validation
elif "val" in dataset:
    use val
else:
    use first available split
```

### æ”¯æŒçš„æ•°æ®æ ¼å¼

- âœ… Arrow æ ¼å¼ï¼ˆHuggingFace datasetsï¼‰
- âœ… å¤šç§åˆ†å‰²åç§°ï¼ˆtest, validation, valï¼‰
- âœ… è‡ªåŠ¨ä¸‹é™åˆ°å¯ç”¨çš„åˆ†å‰²

---

## åç»­æ­¥éª¤

1. âœ… è¿è¡ŒéªŒè¯è„šæœ¬è¯„ä¼° test æ•°æ®ä¸Šçš„æ€§èƒ½
2. ğŸ“Š æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Šå’Œå›¾è¡¨
3. ğŸ“ˆ å¦‚æœæ€§èƒ½æ»¡æ„ï¼Œå‡†å¤‡éƒ¨ç½²æ¨¡å‹
4. ğŸ”„ å¦‚æœæ€§èƒ½ä¸æ»¡æ„ï¼Œè°ƒæ•´æ¨¡å‹åé‡æ–°éªŒè¯

---

**ç‰ˆæœ¬**: v2.0
**æ›´æ–°æ—¥æœŸ**: 2024-01-17
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

